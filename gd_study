by comparison, refer to 
  https://github.com/yiisoft/yii2-imagine


the image is handled in console task, hence web support is not related.

    if(function_exists("imagecreatetruecolor")) {
        echo "true";
    }
    else
        echo "false";

------------ 2016-09-14 12:38:34

online test:
以下是当前环境的gd_info

{
    "GD Version": "bundled (2.1.0 compatible)",
    "FreeType Support": false,
    "T1Lib Support": false,
    "GIF Read Support": true,
    "GIF Create Support": true,
    "JPEG Support": false,
    "PNG Support": true,
    "WBMP Support": true,
    "XPM Support": false,
    "XBM Support": true,
    "JIS-mapped Japanese Font Support": false
}


--------- 2016-09-13 18:23:09
$ cat test.php
<?php
 var_dump(gd_info());
?>

$ php test.php
/home/kidd/workspace/php/tools/test.php:2:
array(12) {
  'GD Version' =>
  string(5) "2.2.3"
  'FreeType Support' =>
  bool(true)
  'FreeType Linkage' =>
  string(13) "with freetype"
  'GIF Read Support' =>
  bool(true)
  'GIF Create Support' =>
  bool(true)
  'JPEG Support' =>
  bool(true)
  'PNG Support' =>
  bool(true)
  'WBMP Support' =>
  bool(true)
  'XPM Support' =>
  bool(true)
  'XBM Support' =>
  bool(true)
  'WebP Support' =>
  bool(true)
  'JIS-mapped Japanese Font Support' =>
  bool(false)
}


----------- 2016-09-13 17:48:36
undefined function call exception does not extend from yii\base\Exception, so be careful.

2016-09-13 17:47:19 [-][info][abc\frontend\components\wxmp\Wechat::postContents] Response: {"ticket":"gQFs8DoAAAAAAAAAASxodHRwOi8vd2VpeGluLnFxLmNvbS9xLzlqc0VSc1Rsdmp6SE90cjhZQlZtAAIEJ8vXVwMEAI0nAA==","expire_seconds":2592000,"url":"http:\/\/weixin.qq.com\/q\/9jsERsTlvjzHOtr8YBVm"}
2016-09-13 17:47:19 [-][error][abc\frontend\components\ErrorHandler::logException] exception 'yii\base\ErrorException' with message 'Call to undefined function frontend\components\imagecreatefromjpeg()' in /niub/www/sourcecode/www-dev.tz8.com/frontend/components/GdImageHandler.php:44
Stack trace:
#0 [internal function]: yii\base\ErrorHandler->handleFatalError()
#1 {main}

$ php yii console/start-worker
[2016-09-13T18:03:21+08:00] [JOB] Starting worker host::kidd-OptiPlex-9020 pid::20700 on queue::default
[2016-09-13T18:03:21+08:00] [JOB] attempting to acquire lock for job::1309568 on host::kidd-OptiPlex-9020 pid::20700
Exception 'Error' with message 'Call to undefined function console\tasks\test()'

in /home/kidd/workspace/bc/advanced/MissionImpossible/console/tasks/QrcodeRequestCheckTask.php:27

Stack trace:
#0 /home/kidd/workspace/bc/advanced/MissionImpossible/console/tasks/QrcodeRequestCheckTask.php(15): console\tasks\QrcodeRequestCheckTask->check()
#1 /home/kidd/workspace/bc/advanced/MissionImpossible/console/tasks/DJJob.php(367): console\tasks\QrcodeRequestCheckTask->perform()
#2 /home/kidd/workspace/bc/advanced/MissionImpossible/console/tasks/DJJob.php(319): console\tasks\DJJob->run()
#3 /home/kidd/workspace/bc/advanced/MissionImpossible/console/tasks/TaskQueue.php(91): console\tasks\DJWorker->start()
#4 /home/kidd/workspace/bc/advanced/MissionImpossible/console/controllers/ConsoleController.php(36): console\tasks\TaskQueue::start()
#5 [internal function]: console\controllers\ConsoleController->actionStartWorker()
#6 /home/kidd/workspace/bc/advanced/MissionImpossible/vendor/yiisoft/yii2/base/InlineAction.php(55): call_user_func_array(Array, Array)
#7 /home/kidd/workspace/bc/advanced/MissionImpossible/vendor/yiisoft/yii2/base/Controller.php(154): yii\base\InlineAction->runWithParams(Array)
#8 /home/kidd/workspace/bc/advanced/MissionImpossible/vendor/yiisoft/yii2/console/Controller.php(119): yii\base\Controller->runAction('start-worker', Array)
#9 /home/kidd/workspace/bc/advanced/MissionImpossible/vendor/yiisoft/yii2/base/Module.php(454): yii\console\Controller->runAction('start-worker', Array)
#10 /home/kidd/workspace/bc/advanced/MissionImpossible/vendor/yiisoft/yii2/console/Application.php(180): yii\base\Module->runAction('console/start-w...', Array)
#11 /home/kidd/workspace/bc/advanced/MissionImpossible/vendor/yiisoft/yii2/console/Application.php(147): yii\console\Application->runAction('console/start-w...', Array)
#12 /home/kidd/workspace/bc/advanced/MissionImpossible/vendor/yiisoft/yii2/base/Application.php(375): yii\console\Application->handleRequest(Object(yii\console\Request))
#13 /home/kidd/workspace/bc/advanced/MissionImpossible/yii(27): yii\base\Application->run()
#14 {main}



--------------- 2016-09-13 14:25:18
CURLFile??


-------- 2016-09-13 14:19:53
    public static function decorateRawQrcode($filename, $qrcode_file_path, $user, $head_img) {
        $start = time();
        // resize qrcode from $qrcode_file_path to $new_raw_qrcode_path
        $new_raw_qrcode_path = Yii::$app->runtimepath."/"."resized_".$filename;
        GdImageHandler::resizeToJpeg($qrcode_file_path, $new_raw_qrcode_path, 160);

        // resize head_img from $head_img to $full_head_img_path
        $head_img_filename = uniqid(date("Y_m_d_H_i_s_"));
        $full_head_img_path = Yii::$app->runtimepath."/".$head_img_filename;
        if(Util::curl_get_image($head_img, $full_head_img_path) === false) {
            Logger::error("decorateRawQrcode, failed to download head image from wechat");
            return false;
        }
        $new_head_img_path = Yii::$app->runtimepath."/"."resized_".$head_img_filename;
        GdImageHandler::resizeToJpeg($full_head_img_path, $new_head_img_path, 130);

        // get all statistics
        $mid = time();
        $stats = MissionManager::getUserMissionStats($user);
        $db_time = time();

        // generate the decorated qrcode
        $dest = Yii::$app->runtimepath."/"."decorated_".$filename;
        GdImageHandler::generateDecoratedQrcode($dest, $user->nickname, $stats['total_count'], $stats['total_reward'], $stats['finish_count'], $stats['create_count'], $new_head_img_path, $new_raw_qrcode_path);
        $end = time();
        Logger::info("before db spent: ".($mid-$start).", db spent: ".($db_time-$mid)." and image handler spent ".($end-$db_time));

        return $dest;
    }
2016-09-13 14:18:44 [-][info][abc\frontend\components\wxmp\Wechat::decorateRawQrcode] before db spent: 5, db spent: 2 and image handler spent 0
    in /home/kidd/workspace/bc/advanced/MissionImpossible/frontend/components/util/Logger.php:17
    in /home/kidd/workspace/bc/advanced/MissionImpossible/frontend/components/wxmp/Wechat.php:340
    in /home/kidd/workspace/bc/advanced/MissionImpossible/frontend/components/wxmp/Wechat.php:293



----------- 2016-09-13 13:43:22

there will be below error if the corresponding user has not interracted with wechat recently.

2016-09-13 13:32:43 [-][error][abc\frontend\components\wxmp\Wechat::postContents] {"errcode":45015,"errmsg":"response out of time limit or subscription is canceled hint: [y.Hkja0764zbg9]"}
    in /home/kidd/workspace/bc/advanced/MissionImpossible/frontend/components/util/Logger.php:25
    in /home/kidd/workspace/bc/advanced/MissionImpossible/frontend/components/wxmp/Wechat.php:401
    in /home/kidd/workspace/bc/advanced/MissionImpossible/frontend/components/wxmp/Wechat.php:190
2016-09-13 13:32:43 [-][error][abc\frontend\components\wxmp\Wechat::postMessageToUser] failed to post message, Wechat::postContents failed
    in /home/kidd/workspace/bc/advanced/MissionImpossible/frontend/components/util/Logger.php:25
    in /home/kidd/workspace/bc/advanced/MissionImpossible/frontend/components/wxmp/Wechat.php:192
    in /home/kidd/workspace/bc/advanced/MissionImpossible/frontend/components/wxmp/Wechat.php:167

------- 2016-09-12 14:53:34
http://www.ltesting.net/ceshi/ruanjianceshikaifajishu/rjcskfyy/php/2007/0525/3726.html

本函数将 TTF (TrueType Fonts) 字型文字写入图片。参数 size 为字形的尺寸；angle 为字型的角度，顺时针计算，0 度为水平，也就是三点钟的方向 (由左到右)，90 度则为由下到上的文字；x,y 二参数为文字的坐标值 (原点为左下角)；参数 col 为字的颜色；fontfile 为字型文件名称，亦可是远端的文件；text 当然就是字符串内容了。返回值为数组，包括了八个元素，头二个分别为左下的 x、y 坐标，第三、四个为右下角的 x、y 坐标，第五、六及七、八二组分别为右上及左上的 x、y 坐标。治募?注意的是欲使用本函数，系统要装妥 GD 及 Freetype 二个函数库。 


http://php.net/manual/en/function.imagettftext.php
<?php
  // Set the content-type
  header('Content-Type: image/png');
  // Create the image
  $im = imagecreatetruecolor(400, 30);
  // Create some colors
  $white = imagecolorallocate($im, 255, 255, 255);
  $grey = imagecolorallocate($im, 128, 128, 128);
  $black = imagecolorallocate($im, 0, 0, 0);
  imagefilledrectangle($im, 0, 0, 399, 29, $white);
  // The text to draw
  $text = 'Testing...';
  // Replace path by your own font path
  $font = 'arial.ttf'; // $font = "/usr/share/fonts/truetype/arphic/ukai.ttc";
  // Add some shadow to the text
  imagettftext($im, 20, 0, 11, 21, $grey, $font, $text);
  // Add the text
  imagettftext($im, 20, 0, 10, 20, $black, $font, $text);
  // Using imagepng() results in clearer text compared with imagejpeg()
  imagepng($im);
  imagedestroy($im);
?>

http://php.net/manual/en/function.imagettftext.php
Returns an array with 8 elements representing four points making the bounding box of the text. The order of the points is lower left, lower right, upper right, upper left. The points are relative to the text regardless of the angle, so "upper left" means in the top left-hand corner when you see the text horizontally. Returns FALSE on error. 

    $arr = imagettftext($image, 20, 0, 10, 30, $black, '/usr/share/fonts/truetype/arphic/ukai.ttc', $schoolname);
    echo json_encode($arr);
$ php imagemerge.php
[11,32,64,32,64,6,11,6]

------------------ 2016-09-12 10:04:16
apt-cache search gd
php5.5-gd - GD module for PHP
php7.0-gd - GD module for PHP


Linux下开启PHP的GD库支持 #开启GD库支持有以下几种方法 ##检测GD库是否安装命令 php5 -m | grep -i gd 或者 php -i | grep -i --color gd ##


dpkg -l | grep gd
ii  libgd3:amd64                                                2.1.0-3                                              amd64        GD Graphics Library

http://blog.163.com/tu_xing_long@126/blog/static/66597197201051522122372/
$ sudo apt-get install php7.0-gd

如果没有的话，可以用命令安装一个:
sudo apt-get install php5-gd.或者为了安装完整版本的,在源列表中添加两行：
deb http://packages.dotdeb.org stable all
deb-src http://packages.dotdeb.org stable all
然后升级下：sudo apt-get update. 再安装php5-gd.

网上有说，安装完成后php.ini会更新，但是我的并没有。搜到gd.so在/usr/lib/php5/20060613+lfs /下,php.ini在/etc/php5/apach2下.于是手动修改php.ini。在其中修改extension_dir=”/usr/lib /php5/20060613+lfs/”,再添加一行extension=gd.so.之后重启apach2: sudo /etc/init.d/apach2 restart。


------------- 2016-09-12 13:45:07
http://blog.csdn.net/bill_chuang/article/details/18349999
以安装simsun字体为例
可以在网上下载，也可以在 windows 目录下找到对应字体，这里是从另一套系统上 copy一个simsun.ttf 文件。
可以用
#fc-list :lang=zh
命令查看当前系统安装的中文字体
然后将字体文件拷贝到/usr/share/fonts/中
#mkdir /usr/share/fonts/my_fonts
#cp /home/simsun.ttf my_fonts/
#cd my_fonts/
#mkfontscale 
#mkfontdir
然后再
#fc-list :lang=zh
就可以看到刚安装的字体了 


------------ 2016-09-12 11:16:20
errors:

PHP Fatal error:  Uncaught Error: Call to undefined function imagecreatetruecolor() in /home/kidd/workspace/php/tools/imagemerge.php:7
  make sure gd is installed.

$ php imagemerge.php > /tmp/merge.jpg
PHP Warning:  Cannot modify header information - headers already sent by (output started at /home/kidd/workspace/php/tools/imagemerge.php:2) in /home/kidd/workspace/php/tools/imagemerge.php on line 18
  http://blog.sina.com.cn/s/blog_6d4bfb040100muw3.html
  1. Blank lines (空白行):
  Make sure no blank line after <?php ... ?> of the calling php script.
  检查有<?php ... ?> 后面没有空白行，特别是include或者require的文件。不少问题是这些空白行导致的。

----------- 2016-09-12 10:31:36

{"0":108,"1":108,"2":2,"3":"width=\"108\" height=\"108\"","bits":8,"channels":3,"mime":"image\/jpeg"}


--------- 2016-09-12 16:06:49

$ php imagemerge.php > /tmp/round.jpg
PHP Fatal error:  Uncaught Error: Class 'Imagick' not found in /home/kidd/workspace/php/tools/imagemerge.php:146
Stack trace:
#0 /home/kidd/workspace/php/tools/imagemerge.php(153): roundHeadImg()
#1 {main}
  thrown in /home/kidd/workspace/php/tools/imagemerge.php on line 146

function roundHeadImg() {

    header('Content-Type: image/png');

    $image = new Imagick('http://wx.qlogo.cn/mmopen/PiajxSqBRaEJkp2ibNelHjpXwSUzqSaUIVRJ8Lxd9HtLDxMic2ziasKXY52oW5RLNLEH203qBoXUiavuZsp0aDnGGtQ/0');
    $image->setImageFormat('jpeg');
    $image->roundCorners($image->getImageWidth() / 2, $image->getImageHeight() / 2);
    echo $image;
    $image->destroy();
}

--------------- 2016-09-12 19:40:57


function mergerImg($imgs) {
    list($max_width, $max_height) = getimagesize($imgs['dst']);
    $dests = imagecreatetruecolor($max_width, $max_height);
    $dst_im = imagecreatefromjpeg($imgs['dst']);
    imagecopy($dests,$dst_im,0,0,0,0,$max_width,$max_height);
    imagedestroy($dst_im);
    $src_im = imagecreatefromjpeg($imgs['src']);
    $src_info = getimagesize($imgs['src']);
    imagecopy($dests,$src_im,$max_width/3,$max_height/3,0,0,$src_info[0],$src_info[1]);
    imagedestroy($src_im);
    header("Content-type: image/jpeg");
    imagejpeg($dests);
}

--------------- 2016-09-13 16:18:53
<?php

namespace frontend\components;

use Yii;
use frontend\components\util\Logger;

class GdImageHandler {
    /**
     * desription 压缩图片
     * @param string $imgsrc 图片路径
     * @param string $imgdst 压缩后保存路径
     * @param int $th max size
     */
    public static function resizeToJpeg($imgsrc, $imgdst, $th=null){
        list($width,$height,$type)=getimagesize($imgsrc);
        if(!is_null($th)) $threshold = $th;
        else $threshold = 130;
        $factor = 1.0;
        if($width>$threshold || $height>$threshold) {
            if($width>$height) {
                $new_width = round($threshold*$factor);
                $new_height = round($height*$threshold*$factor/$width);
            }
            else {
                $new_height = round($threshold*$factor);
                $new_width = round($width*$threshold*$factor/$height);
            }
        }
        else {
            if($width>$height) {
                $new_width = round($threshold*$factor);
                $new_height = round($height*$threshold*$factor/$width);
            }
            else {
                $new_height = round($threshold*$factor);
                $new_width = round($width*$threshold*$factor/$height);
            }
        }
        switch($type){
            case 2:
//                header('Content-Type:image/jpeg');
                $image_wp=imagecreatetruecolor($new_width, $new_height);
                $image = imagecreatefromjpeg($imgsrc);
                imagecopyresampled($image_wp, $image, 0, 0, 0, 0, $new_width, $new_height, $width, $height);
                imagejpeg($image_wp, $imgdst,75);
                imagedestroy($image_wp);
                break;
            case 3:
//                header('Content-Type:image/png');
                $image_wp=imagecreatetruecolor($new_width, $new_height);
                $image = imagecreatefrompng($imgsrc);
                imagecopyresampled($image_wp, $image, 0, 0, 0, 0, $new_width, $new_height, $width, $height);
                imagejpeg($image_wp, $imgdst,75);
                imagedestroy($image_wp);
                break;
            default:
                Logger::error("unknown image type");
                return false;
        }
        return true;
//        echo "trying to compress from $width X $height to $new_width X $new_height\n";
    }

    public static function getImageInfo($img) { // $img为图象文件绝对路径
        $img_info = getimagesize($img);
        switch ($img_info[2]) {
            case 1:
                $imgtype = "GIF";
                break;
            case 2:
                $imgtype = "JPG";
                break;
            case 3:
                $imgtype = "PNG";
                break;
            default:
                break;
        }
        $img_type = $imgtype."图像";
        $img_size = ceil(filesize($img)/1000)."k";
        $new_img_info = array (
            "width"=>$img_info[0],
            "height"=>$img_info[1],
            "type"=>$img_type,
            "size"=>$img_size
        );
        return $new_img_info;
    }

    /**
     * @param $dest output full file path
     * @param $name user nickname
     * @param $challenge_count
     * @param $reward_total
     * @param $finished_count
     * @param $created_missions_count
     * @param $head_img compressed head image
     * @param $qr_img compressed qrcode
     * @param int $dest_width
     * @param int $dest_height
     */
    public static function generateDecoratedQrcode($dest, $name, $challenge_count, $reward_total, $finished_count, $created_missions_count, $head_img, $qr_img, $dest_width = 750, $dest_height = 1334) {
        $qrcode_bg = Yii::$app->basepath.'/../common/resource/images/qrcode_bg.png';
        $head_fg = Yii::$app->basepath.'/../common/resource/images/qrcode_head_fg.png';
        $qrcode_heart = Yii::$app->basepath.'/../common/resource/images/qrcode_heart.jpg';
        $font = Yii::$app->basepath."/../common/resource/font/lantinghei_gbk.ttf";
        $number_font = Yii::$app->basepath."/../common/resource/font/impact_0.ttf";

        if(empty($name)) $name = "Anonymous";
        if(empty($created_missions_count)) $description = "我准备发起挑战";
        else $description = "我发起".$created_missions_count."个挑战";
        $head_image_src = $head_img;
        $qr_image_src = $qr_img;
        $date = date('m月d日', strtotime("+30 days"));
        $bottom_text = "该二维码30天内（". $date . "前）有效";
        // middle texts
        $left_text = $challenge_count;
        $t1 = $reward_total;
        $right_text = $finished_count;

        $center = $dest_width/2;

        $image = imagecreatefrompng($qrcode_bg);

        // add name text
        $color = imagecolorallocate($image,0xff,0xff,0xff);
        $bbox = imagettfbbox(32, 0, $font, $name);
        $width = (abs($bbox[2] - $bbox[0])+1);
        $height = (abs($bbox[5] - $bbox[3])+1);
        $y = 75+130+10+$height;
        $x = $center-$width/2;
        imagettftext($image, 32, 0, $x, $y, $color, $font, $name);

        // add description text
        $color = imagecolorallocate($image,0xfe,0xd0,0xc3);
        $bbox = imagettfbbox(24, 0, $font, $description);
        $width = (abs($bbox[2] - $bbox[0])+1);
        $height = (abs($bbox[5] - $bbox[3])+1);
        $y = $y+10+$height;
        $x = $center-$width/2;
        imagettftext($image, 24, 0, round($x), round($y), $color, $font, $description);

        // add head img
        $head_image = imagecreatefromjpeg($head_image_src);
        $head_image_info = getimagesize($head_image_src);
        $y = 75; // it seems $y should be y coord for the upper point
        $x = 310; // $center - $head_image_info[0]/2;
        imagecopy($image, $head_image, $x, $y, 0, 0, $head_image_info[0], $head_image_info[1]);

        // add head fg
        $head_fg_image = imagecreatefrompng($head_fg);
        $head_fg_image_info = getimagesize($head_fg);
        $y = 56; // it seems $y should be y coord for the upper point
        $x = 291; // $center - $head_image_info[0]/2 + 3;
        imagecopy($image, $head_fg_image, $x, $y, 0, 0, $head_fg_image_info[0], $head_fg_image_info[1]);

        // obtain qr and add qr to bg
        $qr_image = imagecreatefromjpeg($qr_image_src);
        $y = $dest_height-60-160; // here $y should be y coord for the upper point
        $x = 295;
        imagecopy($image, $qr_image, $x, $y, 0, 0, 160, 160);
        $qr_heart_image = imagecreatefromjpeg($qrcode_heart);
        $y = $dest_height-60-80-17;
        $x = 358;
        imagecopy($image, $qr_heart_image, $x, $y, 0, 0, 34, 34);

        // add bottom text
        $color = imagecolorallocate($image,0x99,0x99,0x99);
        $bbox = imagettfbbox(15, 0, $font, $bottom_text);
        $width = (abs($bbox[2] - $bbox[0])+1);
        $height = (abs($bbox[5] - $bbox[3])+1);
        $y = $dest_height - 30 + $height/2;
        $x = $center-$width/2;
        imagettftext($image, 15, 0, round($x), round($y), $color, $font, $bottom_text);

        // add middle numbers
        // 1. left
        $color = imagecolorallocate($image,0x66,0x66,0x66);
        $bbox = imagettfbbox(36, 0, $number_font, $left_text);
        $width = (abs($bbox[2] - $bbox[0])+1);
        $height = (abs($bbox[5] - $bbox[3])+1);
        $y = 640 + $height;
        $x = 115-$width/2;
        imagettftext($image, 36, 0, round($x), round($y), $color, $number_font, $left_text);

        // 2. mid
        $c1 = imagecolorallocate($image,0x8a,0x4f,0x02);
        $bbox = imagettfbbox(54, 0, $number_font, $t1);
        $w1 = (abs($bbox[2] - $bbox[0])+1);
        $h1 = (abs($bbox[5] - $bbox[3])+1);
        $t2 = "元";
        $c2 = imagecolorallocate($image,0x8a,0x4f,0x02);
        $bbox = imagettfbbox(20, 0, $font, $t2);
        $w2 = (abs($bbox[2] - $bbox[0])+1);
        $h2 = (abs($bbox[5] - $bbox[3])+1);
        $y1 = 630 + $h1;
        $x1 = 375-($w1+$w2)/2;
        imagettftext($image, 54, 0, round($x1), round($y1), $c1, $number_font, $t1);
        $y2 = 630 + $h2;
        $x2 = $x1+$w1;
        imagettftext($image, 20, 0, round($x2), round($y2), $c2, $font, $t2);

        // 3. right
        $color = imagecolorallocate($image,0x66,0x66,0x66);
        $bbox = imagettfbbox(36, 0, $number_font, $right_text);
        $width = (abs($bbox[2] - $bbox[0])+1);
        $height = (abs($bbox[5] - $bbox[3])+1);
        $y = 640 + $height;
        $x = 750-115-$width/2;
        imagettftext($image, 36, 0, round($x), round($y), $color, $number_font, $right_text);

        imagepng($image, $dest);
        imagedestroy($image);
    }
}



    public static function generateAndSendTemporaryQrcode($account_id=null) {
        // get user open id
        if($account_id == null) {
            $account_id = $_COOKIE[AccountManager::USER_ID];
        }

        $account = Account::findOne($account_id);
        if(is_null($account)) {
            throw new AppException("Account id not existing: ".$account_id);
        }
        $open_id = $account->open_id;

        // step 1: generate temporary qrcode url
        $user = User::findOne(['account_id' => $account_id]);
        if(is_null($user)) {
            throw new AppException("user not found");
        }
        $response = self::getTemporary($user->id);
        $ticket = $response['ticket'];
        $url = "https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=$ticket";

        // step 2: download image to local
        $prefix = uniqid(date("Y_m_d_H_i_s_"));
        $old_qrcode_path = Yii::$app->runtimepath."/".$prefix.".jpg";
        if(Util::curl_get_image($url, $old_qrcode_path) === false) {
            Logger::error("action send temporary qrcode, failed to download image from wechat");
            return false;
        }
        $decorated_qrcode_path = Wechat::decorateRawQrcode($prefix, $old_qrcode_path, $user, $user->head_img);
        if(!$decorated_qrcode_path) {
            unlink($old_qrcode_path);
            Logger::error("action send temporary qrcode, failed to generate a decorated qrcode");
            return false;
        }

        // step 3: upload the image to wechat and get media id
        $media_id = Wechat::postImageToServer($decorated_qrcode_path, 'image/png');

        // step 4: send image to user
        if($media_id !== false) {
            Wechat::postImageToUser($open_id, $media_id);
        }

        // step 5: to delete the local temp image
        unlink($old_qrcode_path);
        unlink($decorated_qrcode_path);

        return true;
    }

    public static function decorateRawQrcode($prefix, $qrcode_file_path, $user, $head_img) {
        if (!YII_ENV_PROD) {
            $start = round(microtime(true)*1000);
        }
        // resize qrcode from $qrcode_file_path to $new_raw_qrcode_path
        $new_raw_qrcode_path = Yii::$app->runtimepath."/"."resized_".$prefix;
        $ret = GdImageHandler::resizeToJpeg($qrcode_file_path, $new_raw_qrcode_path, 160);
        if(!$ret) {
            return false;
        }
        if (!YII_ENV_PROD) {
            $resize_time_1 = round(microtime(true)*1000);
        }

        // resize head_img from $head_img to $old_head_img_path
        $head_img_filename = uniqid(date("Y_m_d_H_i_s_"));
        $old_head_img_path = Yii::$app->runtimepath."/".$head_img_filename;
        if(Util::curl_get_image($head_img, $old_head_img_path) === false) {
            unlink($new_raw_qrcode_path);
            Logger::error("decorateRawQrcode, failed to download head image from wechat");
            return false;
        }
        if (!YII_ENV_PROD) {
            $download_time = round(microtime(true)*1000);
        }
        $new_head_img_path = Yii::$app->runtimepath."/"."resized_".$head_img_filename;
        $ret = GdImageHandler::resizeToJpeg($old_head_img_path, $new_head_img_path, 130);
        if(!$ret) {
            unlink($new_raw_qrcode_path);
            unlink($old_head_img_path);
            return false;
        }

        // get all statistics
        if (!YII_ENV_PROD) {
            $resize_time_2 = round(microtime(true)*1000);
        }
        $stats = MissionManager::getUserMissionStats($user);
        if (!YII_ENV_PROD) {
            $db_time = round(microtime(true)*1000);
        }

        // generate the decorated qrcode
        $dest = Yii::$app->runtimepath."/"."decorated_".$prefix.".png";
        GdImageHandler::generateDecoratedQrcode($dest, $user->nickname, $stats['total_count'], $stats['total_reward'], $stats['finish_count'], $stats['create_count'], $new_head_img_path, $new_raw_qrcode_path);
        if (!YII_ENV_PROD) {
            $end = round(microtime(true)*1000);
            Logger::info("resize_01: ".($resize_time_1-$start).", download: ".($download_time-$resize_time_1).", resize_02 ".($resize_time_2-$download_time
                    .", db_time ".($db_time-$resize_time_2)
                    .", graph time: ".($end-$db_time)
                    .", total time: ".($end-$start)));
        }

        unlink($new_raw_qrcode_path);
        unlink($old_head_img_path);
        unlink($new_head_img_path);

        return $dest;
    }

    /**
     * get_contents
     * @Author  qjliu@niub.la
     * @AddTime 2015-08-07
     * @param   string        $url
     * @return  mixed
     */
    private static function get_contents($url, $token=null, $try_count=0) {
        if ($try_count > self::MAX_TRY_COUNT) {
            Logger::error('get contents failed, reach max try count');
            return false;
        }
        Logger::logFunctionCall();
        if (!is_null($token)) {
            $full_url = sprintf($url, $token);
        } else {
            $full_url = $url;
        }
        $response =  Util::curl('GET', $full_url);
        // try again
        if(empty($response['res'])){
            Logger::warning('get_contents failed, try again');
            return self::get_contents($url, $token, $try_count+1);
        }
        Logger::info('Response: ' . $response['res']);

        $response = json_decode($response['res'], true);
        if(!empty($response['errcode'])) {
            Logger::error(json_encode($response));
            // check response, if token invalid, refresh token and try again
            if ($response['errcode'] == self::INVALID_TOKEN_CODE && !is_null($token)) {
                // refresh access token
                $new_token = self::getMpAccessToken(true);
                return self::get_contents($url, $new_token, $try_count+1);
            }
            return false;
        }
        return $response;
    }

    public static function postContents($url, $post_data, $header, $token=null, $try_count=0) {
        Logger::logFunctionCall();
        if ($try_count > self::MAX_TRY_COUNT) {
            Logger::warning('post contents failed, reach max try count');
            return false;
        }
        if (!is_null($token)) {
            $full_url = sprintf($url, $token);
        } else {
            $full_url = $url;
        }
        $response =  Util::curl('POST', $full_url, $post_data, $header);
        if(empty($response['res'])){
            Logger::warning('post contents failed, try again');
            return self::postContents($url, $post_data, $header, $token, $try_count+1);
        }
        Logger::info('Response: ' . $response['res']);

        $response = json_decode($response['res'], true);
        if(!empty($response['errcode'])) {
            Logger::error(json_encode($response));
            // check response, if token invalid, refresh token and try again
            if ($response['errcode'] == self::INVALID_TOKEN_CODE && !is_null($token)) {
                Logger::info('access token invalid, refresh token and try again');
                // refresh access token
                $new_token = self::getMpAccessToken(true);
                return self::postContents($url, $post_data, $header, $new_token, $try_count+1);
            }
            return false;
        }
        return $response;
    }

----------- 2016-09-13 18:39:20
simple gd test:

<?php

function addTextToImage($dest) {

    $qrcode_bg = '/home/kidd/tmp/images/qrcode_bg.png';
    $head_image_src = '/tmp/thumb.jpg';

    $image = imagecreatefrompng($qrcode_bg);

    // add head img
    $head_image = imagecreatefromjpeg($head_image_src);
    $head_image_info = getimagesize($head_image_src);
    $y = 75; // it seems $y should be y coord for the upper point
    $x = 310; // $center - $head_image_info[0]/2;
    imagecopy($image, $head_image, $x, $y, 0, 0, $head_image_info[0], $head_image_info[1]);


//        imagepng($image, $dest);
    imagepng($image, $dest);
    imagedestroy($image);
}

addTextToImage("hello.png");

?>

---------- 2016-09-14 10:07:18
string image

http://php.about.com/od/phpfunctions/g/imagestring_php.htm

<?php
    $bg_w    = 150; // 背景图片宽度
    $bg_h    = 150; // 背景图片高度
  
    $background = imagecreatetruecolor($bg_w,$bg_h); // 背景图片
    $color   = imagecolorallocate($background, 0, 0xff, 0); // 为真彩色画布创建白色背景，再设置为透明
    imagefill($background, 0, 0, $color);
    $black   = imagecolorallocate($background, 0, 0, 0); // 为真彩色画布创建白色背景，再设置为透明

    imagestring ($background, 5, 5, 18, "PHP.About.com", $black);
  
    // header("Content-type: image/jpg");
    imagejpeg($background, 'test.jpg');
    imagedestroy($background);
?>

------------ 2016-09-14 10:34:22
PHP imagettfbbox 取得使用 TrueType 字体的文本的范围
imagettfbbox

(PHP 4, PHP 5)

imagettfbbox — 取得使用 TrueType 字体的文本的范围
说明
array imagettfbbox ( float $size , float $angle , string $fontfile , string $text )

本函数计算并返回一个包围着 TrueType 文本范围的虚拟方框的像素大小。

size
    像素单位的字体大小。 
angle
    text 将被度量的角度大小。 
fontfile
    TrueType 字体文件的文件名（可以是 URL）。根据 PHP 所使用的 GD 库版本，可能尝试搜索那些不是以 '/' 开头的文件名并加上 '.ttf' 的后缀并搜索库定义的字体路径。 
text
    要度量的字符串。 

imagettfbbox() 返回一个含有 8 个单元的数组表示了文本外框的四个角：
0   左下角 X 位置
1   左下角 Y 位置
2   右下角 X 位置
3   右下角 Y 位置
4   右上角 X 位置
5   右上角 Y 位置
6   左上角 X 位置
7   左上角 Y 位置
这些点是相对于文本的而和角度无关，因此“左上角”指的是以水平方向看文字时其左上角。

本函数同时需要 GD 库和 FreeType 库。

参见 imagettftext()。


------------ 2016-09-14 11:16:46
2016-09-14 10:57:23 [-][-][-][error][yii\base\ErrorException:1] exception 'yii\base\ErrorException' with message 'Call to undefined function frontend\components\imagecreatefromjpeg()' in /niub/www/sourcecode/www-dev.tz8.com/frontend/components/GdImageHandler.php:44
Stack trace:
#0 [internal function]: yii\base\ErrorHandler->handleFatalError()
#1 {main}
2016-09-14 10:57:23 [-][-][-][info][application] $_SERVER = [
    'LESSOPEN' => '|/usr/bin/lesspipe.sh %s'
    'SSH_CLIENT' => '113.57.168.243 57392 22'
    'CVS_RSH' => 'ssh'
    'LOGNAME' => 'root'
    'USER' => 'root'
    'HOME' => '/root'
    'PATH' => '/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin'
    'LANG' => 'zh_CN.UTF-8'
    'TERM' => 'xterm-256color'
    'SHELL' => '/bin/bash'
    'SHLVL' => '1'
    'G_BROKEN_FILENAMES' => '1'
    'SUPERVISOR_ENABLED' => '1'
    'HISTSIZE' => '1000'
    'SUPERVISOR_PROCESS_NAME' => 'tz8-dev'
    'SUPERVISOR_SERVER_URL' => 'unix:///var/run/supervisor.sock'
    '_' => '/usr/local/bin/supervisord'
    'SSH_CONNECTION' => '113.57.168.243 57392 121.43.153.62 22'
    'SSH_TTY' => '/dev/pts/4'
    'OLDPWD' => '/usr/local/python2.7'
    'HOSTNAME' => 'tz8-server001'
    'HISTCONTROL' => 'ignoredups'
    'PWD' => '/usr/local/python2.7/bin'
    'MAIL' => '/var/spool/mail/root'
    'LS_COLORS' => 'rs=0:di=38;5;27:ln=38;5;51:mh=44;38;5;15:pi=40;38;5;11:so=38;5;13:do=38;5;5:bd=48;5;232;38;5;11:cd=48;5;232;38;5;3:or=48;5;232;38;5;9:mi=05;48;5;232;38;5;15:su=48;5;196;38;5;15:sg=48;5;11;38;5;16:ca=48;5;196;38;5;226:tw=48;5;10;38;5;16:ow=48;5;10;38;5;21:st=48;5;21;38;5;15:ex=38;5;34:*.tar=38;5;9:*.tgz=38;5;9:*.arj=38;5;9:*.taz=38;5;9:*.lzh=38;5;9:*.lzma=38;5;9:*.tlz=38;5;9:*.txz=38;5;9:*.zip=38;5;9:*.z=38;5;9:*.Z=38;5;9:*.dz=38;5;9:*.gz=38;5;9:*.lz=38;5;9:*.xz=38;5;9:*.bz2=38;5;9:*.tbz=38;5;9:*.tbz2=38;5;9:*.bz=38;5;9:*.tz=38;5;9:*.deb=38;5;9:*.rpm=38;5;9:*.jar=38;5;9:*.rar=38;5;9:*.ace=38;5;9:*.zoo=38;5;9:*.cpio=38;5;9:*.7z=38;5;9:*.rz=38;5;9:*.jpg=38;5;13:*.jpeg=38;5;13:*.gif=38;5;13:*.bmp=38;5;13:*.pbm=38;5;13:*.pgm=38;5;13:*.ppm=38;5;13:*.tga=38;5;13:*.xbm=38;5;13:*.xpm=38;5;13:*.tif=38;5;13:*.tiff=38;5;13:*.png=38;5;13:*.svg=38;5;13:*.svgz=38;5;13:*.mng=38;5;13:*.pcx=38;5;13:*.mov=38;5;13:*.mpg=38;5;13:*.mpeg=38;5;13:*.m2v=38;5;13:*.mkv=38;5;13:*.ogm=38;5;13:*.mp4=38;5;13:*.m4v=38;5;13:*.mp4v=38;5;13:*.vob=38;5;13:*.qt=38;5;13:*.nuv=38;5;13:*.wmv=38;5;13:*.asf=38;5;13:*.rm=38;5;13:*.rmvb=38;5;13:*.flc=38;5;13:*.avi=38;5;13:*.fli=38;5;13:*.flv=38;5;13:*.gl=38;5;13:*.dl=38;5;13:*.xcf=38;5;13:*.xwd=38;5;13:*.yuv=38;5;13:*.cgm=38;5;13:*.emf=38;5;13:*.axv=38;5;13:*.anx=38;5;13:*.ogv=38;5;13:*.ogx=38;5;13:*.aac=38;5;45:*.au=38;5;45:*.flac=38;5;45:*.mid=38;5;45:*.midi=38;5;45:*.mka=38;5;45:*.mp3=38;5;45:*.mpc=38;5;45:*.ogg=38;5;45:*.ra=38;5;45:*.wav=38;5;45:*.axa=38;5;45:*.oga=38;5;45:*.spx=38;5;45:*.xspf=38;5;45:'
    'SUPERVISOR_GROUP_NAME' => 'tz8-dev'
    'PHP_SELF' => 'yii'
    'SCRIPT_NAME' => 'yii'
    'SCRIPT_FILENAME' => 'yii'
    'PATH_TRANSLATED' => 'yii'
    'DOCUMENT_ROOT' => ''
    'REQUEST_TIME_FLOAT' => 1473821843.558
    'REQUEST_TIME' => 1473821843
    'argv' => [
        0 => 'yii'
        1 => 'console/start-worker'
    ]
    'argc' => 2
]

--------- 2016-09-14 16:58:50
phpinfo()
PHP Version => 7.0.9-1+deb.sury.org~trusty+1

System => Linux kidd-OptiPlex-9020 3.13.11-ckt363.13.0_kidd #1 SMP Wed Apr 6 18:10:00 CST 2016 x86_64
Server API => Command Line Interface
Virtual Directory Support => disabled
Configuration File (php.ini) Path => /etc/php/7.0/cli
Loaded Configuration File => /etc/php/7.0/cli/php.ini
Scan this dir for additional .ini files => /etc/php/7.0/cli/conf.d
Additional .ini files parsed => /etc/php/7.0/cli/conf.d/10-mysqlnd.ini,
/etc/php/7.0/cli/conf.d/10-opcache.ini,
/etc/php/7.0/cli/conf.d/10-pdo.ini,
/etc/php/7.0/cli/conf.d/15-xml.ini,
/etc/php/7.0/cli/conf.d/20-calendar.ini,
/etc/php/7.0/cli/conf.d/20-ctype.ini,
/etc/php/7.0/cli/conf.d/20-curl.ini,
/etc/php/7.0/cli/conf.d/20-dom.ini,
/etc/php/7.0/cli/conf.d/20-exif.ini,
/etc/php/7.0/cli/conf.d/20-fileinfo.ini,
/etc/php/7.0/cli/conf.d/20-ftp.ini,
/etc/php/7.0/cli/conf.d/20-gd.ini,
/etc/php/7.0/cli/conf.d/20-gettext.ini,
/etc/php/7.0/cli/conf.d/20-iconv.ini,
/etc/php/7.0/cli/conf.d/20-json.ini,
/etc/php/7.0/cli/conf.d/20-mbstring.ini,
/etc/php/7.0/cli/conf.d/20-mysqli.ini,
/etc/php/7.0/cli/conf.d/20-pdo_mysql.ini,
/etc/php/7.0/cli/conf.d/20-phar.ini,
/etc/php/7.0/cli/conf.d/20-posix.ini,
/etc/php/7.0/cli/conf.d/20-readline.ini,
/etc/php/7.0/cli/conf.d/20-shmop.ini,
/etc/php/7.0/cli/conf.d/20-simplexml.ini,
/etc/php/7.0/cli/conf.d/20-sockets.ini,
/etc/php/7.0/cli/conf.d/20-sysvmsg.ini,
/etc/php/7.0/cli/conf.d/20-sysvsem.ini,
/etc/php/7.0/cli/conf.d/20-sysvshm.ini,
/etc/php/7.0/cli/conf.d/20-tokenizer.ini,
/etc/php/7.0/cli/conf.d/20-wddx.ini,
/etc/php/7.0/cli/conf.d/20-xmlreader.ini,
/etc/php/7.0/cli/conf.d/20-xmlwriter.ini,
/etc/php/7.0/cli/conf.d/20-xsl.ini

PHP API => 20151012
PHP Extension => 20151012
Zend Extension => 320151012
Zend Extension Build => API320151012,NTS
PHP Extension Build => API20151012,NTS
Debug Build => no
Thread Safety => disabled
Zend Signal Handling => disabled
Zend Memory Manager => enabled
Zend Multibyte Support => provided by mbstring
IPv6 Support => enabled
DTrace Support => enabled

Registered PHP Streams => https, ftps, compress.zlib, php, file, glob, data, http, ftp, phar
Registered Stream Socket Transports => tcp, udp, unix, udg, ssl, tls, tlsv1.0, tlsv1.1, tlsv1.2
Registered Stream Filters => zlib.*, string.rot13, string.toupper, string.tolower, string.strip_tags, convert.*, consumed, dechunk, convert.iconv.*

This program makes use of the Zend Scripting Language Engine:
Zend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies
    with Xdebug v2.4.1, Copyright (c) 2002-2016, by Derick Rethans
    with Zend OPcache v7.0.9-1+deb.sury.org~trusty+1, Copyright (c) 1999-2016, by Zend Technologies


 _______________________________________________________________________


Configuration

calendar

Calendar support => enabled

Core

PHP Version => 7.0.9-1+deb.sury.org~trusty+1

Directive => Local Value => Master Value
allow_url_fopen => On => On
allow_url_include => Off => Off
arg_separator.input => & => &
arg_separator.output => & => &
auto_append_file => no value => no value
auto_globals_jit => On => On
auto_prepend_file => no value => no value
browscap => no value => no value
default_charset => UTF-8 => UTF-8
default_mimetype => text/html => text/html
disable_classes => no value => no value
disable_functions => no value => no value
display_errors => Off => Off
display_startup_errors => Off => Off
doc_root => no value => no value
docref_ext => no value => no value
docref_root => no value => no value
enable_dl => Off => Off
enable_post_data_reading => On => On
error_append_string => no value => no value
error_log => no value => no value
error_prepend_string => no value => no value
error_reporting => 22527 => 22527
exit_on_timeout => Off => Off
expose_php => On => On
extension_dir => /usr/lib/php/20151012 => /usr/lib/php/20151012
file_uploads => On => On
highlight.comment => <font style="color: #FF8000">#FF8000</font> => <font style="color: #FF8000">#FF8000</font>
highlight.default => <font style="color: #0000BB">#0000BB</font> => <font style="color: #0000BB">#0000BB</font>
highlight.html => <font style="color: #000000">#000000</font> => <font style="color: #000000">#000000</font>
highlight.keyword => <font style="color: #007700">#007700</font> => <font style="color: #007700">#007700</font>
highlight.string => <font style="color: #DD0000">#DD0000</font> => <font style="color: #DD0000">#DD0000</font>
html_errors => Off => Off
ignore_repeated_errors => Off => Off
ignore_repeated_source => Off => Off
ignore_user_abort => Off => Off
implicit_flush => On => On
include_path => .:/usr/share/php => .:/usr/share/php
input_encoding => no value => no value
internal_encoding => no value => no value
log_errors => On => On
log_errors_max_len => 1024 => 1024
mail.add_x_header => On => On
mail.force_extra_parameters => no value => no value
mail.log => no value => no value
max_execution_time => 0 => 0
max_file_uploads => 20 => 20
max_input_nesting_level => 64 => 64
max_input_time => -1 => -1
max_input_vars => 1000 => 1000
memory_limit => -1 => -1
open_basedir => no value => no value
output_buffering => 0 => 0
output_encoding => no value => no value
output_handler => no value => no value
post_max_size => 8M => 8M
precision => 14 => 14
realpath_cache_size => 16K => 16K
realpath_cache_ttl => 120 => 120
register_argc_argv => On => On
report_memleaks => On => On
report_zend_debug => Off => Off
request_order => GP => GP
sendmail_from => no value => no value
sendmail_path => /usr/sbin/sendmail -t -i  => /usr/sbin/sendmail -t -i 
serialize_precision => 17 => 17
short_open_tag => Off => Off
SMTP => localhost => localhost
smtp_port => 25 => 25
sql.safe_mode => Off => Off
sys_temp_dir => no value => no value
track_errors => Off => Off
unserialize_callback_func => no value => no value
upload_max_filesize => 2M => 2M
upload_tmp_dir => no value => no value
user_dir => no value => no value
user_ini.cache_ttl => 300 => 300
user_ini.filename => .user.ini => .user.ini
variables_order => GPCS => GPCS
xmlrpc_error_number => 0 => 0
xmlrpc_errors => Off => Off
zend.assertions => -1 => -1
zend.detect_unicode => On => On
zend.enable_gc => On => On
zend.multibyte => Off => Off
zend.script_encoding => no value => no value

ctype

ctype functions => enabled

curl

cURL support => enabled
cURL Information => 7.35.0
Age => 3
Features
AsynchDNS => Yes
CharConv => No
Debug => No
GSS-Negotiate => Yes
IDN => Yes
IPv6 => Yes
krb4 => No
Largefile => Yes
libz => Yes
NTLM => Yes
NTLMWB => Yes
SPNEGO => No
SSL => Yes
SSPI => No
TLS-SRP => Yes
HTTP2 => No
Protocols => dict, file, ftp, ftps, gopher, http, https, imap, imaps, ldap, ldaps, pop3, pop3s, rtmp, rtsp, smtp, smtps, telnet, tftp
Host => x86_64-pc-linux-gnu
SSL Version => OpenSSL/1.0.1f
ZLib Version => 1.2.8

date

date/time support => enabled
"Olson" Timezone Database Version => 0.system
Timezone Database => internal
Default timezone => Asia/Shanghai

Directive => Local Value => Master Value
date.default_latitude => 31.7667 => 31.7667
date.default_longitude => 35.2333 => 35.2333
date.sunrise_zenith => 90.583333 => 90.583333
date.sunset_zenith => 90.583333 => 90.583333
date.timezone => no value => no value

dom

DOM/XML => enabled
DOM/XML API Version => 20031129
libxml Version => 2.9.1
HTML Support => enabled
XPath Support => enabled
XPointer Support => enabled
Schema Support => enabled
RelaxNG Support => enabled

exif

EXIF Support => enabled
EXIF Version => 1.4 $Id: 8bdc0c8f27c2c9dd1f7551f1f9fe3ab57a06a4b1 $
Supported EXIF Version => 0220
Supported filetypes => JPEG,TIFF

Directive => Local Value => Master Value
exif.decode_jis_intel => JIS => JIS
exif.decode_jis_motorola => JIS => JIS
exif.decode_unicode_intel => UCS-2LE => UCS-2LE
exif.decode_unicode_motorola => UCS-2BE => UCS-2BE
exif.encode_jis => no value => no value
exif.encode_unicode => ISO-8859-15 => ISO-8859-15

fileinfo

fileinfo support => enabled
version => 1.0.5
libmagic => 522

filter

Input Validation and Filtering => enabled
Revision => $Id: 2c8dde9d49ae877877eccaf496c8f5a733b4f1c2 $

Directive => Local Value => Master Value
filter.default => unsafe_raw => unsafe_raw
filter.default_flags => no value => no value

ftp

FTP support => enabled
FTPS support => enabled

gd

GD Support => enabled
GD headers Version => 2.2.3
GD library Version => 2.2.3
FreeType Support => enabled
FreeType Linkage => with freetype
FreeType Version => 2.5.2
GIF Read Support => enabled
GIF Create Support => enabled
JPEG Support => enabled
libJPEG Version => 8
PNG Support => enabled
libPNG Version => 1.2.50
WBMP Support => enabled
XPM Support => enabled
libXpm Version => 30411
XBM Support => enabled
WebP Support => enabled

Directive => Local Value => Master Value
gd.jpeg_ignore_warning => 0 => 0

gettext

GetText Support => enabled

hash

hash support => enabled
Hashing Engines => md2 md4 md5 sha1 sha224 sha256 sha384 sha512 ripemd128 ripemd160 ripemd256 ripemd320 whirlpool tiger128,3 tiger160,3 tiger192,3 tiger128,4 tiger160,4 tiger192,4 snefru snefru256 gost gost-crypto adler32 crc32 crc32b fnv132 fnv1a32 fnv164 fnv1a64 joaat haval128,3 haval160,3 haval192,3 haval224,3 haval256,3 haval128,4 haval160,4 haval192,4 haval224,4 haval256,4 haval128,5 haval160,5 haval192,5 haval224,5 haval256,5 

MHASH support => Enabled
MHASH API Version => Emulated Support

iconv

iconv support => enabled
iconv implementation => glibc
iconv library version => 2.19

Directive => Local Value => Master Value
iconv.input_encoding => no value => no value
iconv.internal_encoding => no value => no value
iconv.output_encoding => no value => no value

json

json support => enabled
json version => 1.4.0

libxml

libXML support => active
libXML Compiled Version => 2.9.1
libXML Loaded Version => 20901
libXML streams => enabled

mbstring

Multibyte Support => enabled
Multibyte string engine => libmbfl
HTTP input encoding translation => disabled
libmbfl version => 1.3.2
oniguruma version => 5.9.6

mbstring extension makes use of "streamable kanji code filter and converter", which is distributed under the GNU Lesser General Public License version 2.1.

Multibyte (japanese) regex support => enabled
Multibyte regex (oniguruma) backtrack check => On
Multibyte regex (oniguruma) version => 5.9.6

Directive => Local Value => Master Value
mbstring.detect_order => no value => no value
mbstring.encoding_translation => Off => Off
mbstring.func_overload => 0 => 0
mbstring.http_input => no value => no value
mbstring.http_output => no value => no value
mbstring.http_output_conv_mimetypes => ^(text/|application/xhtml\+xml) => ^(text/|application/xhtml\+xml)
mbstring.internal_encoding => no value => no value
mbstring.language => neutral => neutral
mbstring.strict_detection => Off => Off
mbstring.substitute_character => no value => no value

mysqli

MysqlI Support => enabled
Client API library version => mysqlnd 5.0.12-dev - 20150407 - $Id: 241ae00989d1995ffcbbf63d579943635faf9972 $
Active Persistent Links => 0
Inactive Persistent Links => 0
Active Links => 0

Directive => Local Value => Master Value
mysqli.allow_local_infile => On => On
mysqli.allow_persistent => On => On
mysqli.default_host => no value => no value
mysqli.default_port => 3306 => 3306
mysqli.default_pw => no value => no value
mysqli.default_socket => no value => no value
mysqli.default_user => no value => no value
mysqli.max_links => Unlimited => Unlimited
mysqli.max_persistent => Unlimited => Unlimited
mysqli.reconnect => Off => Off
mysqli.rollback_on_cached_plink => Off => Off

mysqlnd

mysqlnd => enabled
Version => mysqlnd 5.0.12-dev - 20150407 - $Id: 241ae00989d1995ffcbbf63d579943635faf9972 $
Compression => supported
core SSL => supported
extended SSL => supported
Command buffer size => 4096
Read buffer size => 32768
Read timeout => 31536000
Collecting statistics => Yes
Collecting memory statistics => No
Tracing => n/a
Loaded plugins => mysqlnd,debug_trace,auth_plugin_mysql_native_password,auth_plugin_mysql_clear_password,auth_plugin_sha256_password
API Extensions => mysqli,pdo_mysql

mysqlnd statistics =>  
bytes_sent => 0
bytes_received => 0
packets_sent => 0
packets_received => 0
protocol_overhead_in => 0
protocol_overhead_out => 0
bytes_received_ok_packet => 0
bytes_received_eof_packet => 0
bytes_received_rset_header_packet => 0
bytes_received_rset_field_meta_packet => 0
bytes_received_rset_row_packet => 0
bytes_received_prepare_response_packet => 0
bytes_received_change_user_packet => 0
packets_sent_command => 0
packets_received_ok => 0
packets_received_eof => 0
packets_received_rset_header => 0
packets_received_rset_field_meta => 0
packets_received_rset_row => 0
packets_received_prepare_response => 0
packets_received_change_user => 0
result_set_queries => 0
non_result_set_queries => 0
no_index_used => 0
bad_index_used => 0
slow_queries => 0
buffered_sets => 0
unbuffered_sets => 0
ps_buffered_sets => 0
ps_unbuffered_sets => 0
flushed_normal_sets => 0
flushed_ps_sets => 0
ps_prepared_never_executed => 0
ps_prepared_once_executed => 0
rows_fetched_from_server_normal => 0
rows_fetched_from_server_ps => 0
rows_buffered_from_client_normal => 0
rows_buffered_from_client_ps => 0
rows_fetched_from_client_normal_buffered => 0
rows_fetched_from_client_normal_unbuffered => 0
rows_fetched_from_client_ps_buffered => 0
rows_fetched_from_client_ps_unbuffered => 0
rows_fetched_from_client_ps_cursor => 0
rows_affected_normal => 0
rows_affected_ps => 0
rows_skipped_normal => 0
rows_skipped_ps => 0
copy_on_write_saved => 0
copy_on_write_performed => 0
command_buffer_too_small => 0
connect_success => 0
connect_failure => 0
connection_reused => 0
reconnect => 0
pconnect_success => 0
active_connections => 0
active_persistent_connections => 0
explicit_close => 0
implicit_close => 0
disconnect_close => 0
in_middle_of_command_close => 0
explicit_free_result => 0
implicit_free_result => 0
explicit_stmt_close => 0
implicit_stmt_close => 0
mem_emalloc_count => 0
mem_emalloc_amount => 0
mem_ecalloc_count => 0
mem_ecalloc_amount => 0
mem_erealloc_count => 0
mem_erealloc_amount => 0
mem_efree_count => 0
mem_efree_amount => 0
mem_malloc_count => 0
mem_malloc_amount => 0
mem_calloc_count => 0
mem_calloc_amount => 0
mem_realloc_count => 0
mem_realloc_amount => 0
mem_free_count => 0
mem_free_amount => 0
mem_estrndup_count => 0
mem_strndup_count => 0
mem_estndup_count => 0
mem_strdup_count => 0
proto_text_fetched_null => 0
proto_text_fetched_bit => 0
proto_text_fetched_tinyint => 0
proto_text_fetched_short => 0
proto_text_fetched_int24 => 0
proto_text_fetched_int => 0
proto_text_fetched_bigint => 0
proto_text_fetched_decimal => 0
proto_text_fetched_float => 0
proto_text_fetched_double => 0
proto_text_fetched_date => 0
proto_text_fetched_year => 0
proto_text_fetched_time => 0
proto_text_fetched_datetime => 0
proto_text_fetched_timestamp => 0
proto_text_fetched_string => 0
proto_text_fetched_blob => 0
proto_text_fetched_enum => 0
proto_text_fetched_set => 0
proto_text_fetched_geometry => 0
proto_text_fetched_other => 0
proto_binary_fetched_null => 0
proto_binary_fetched_bit => 0
proto_binary_fetched_tinyint => 0
proto_binary_fetched_short => 0
proto_binary_fetched_int24 => 0
proto_binary_fetched_int => 0
proto_binary_fetched_bigint => 0
proto_binary_fetched_decimal => 0
proto_binary_fetched_float => 0
proto_binary_fetched_double => 0
proto_binary_fetched_date => 0
proto_binary_fetched_year => 0
proto_binary_fetched_time => 0
proto_binary_fetched_datetime => 0
proto_binary_fetched_timestamp => 0
proto_binary_fetched_string => 0
proto_binary_fetched_json => 0
proto_binary_fetched_blob => 0
proto_binary_fetched_enum => 0
proto_binary_fetched_set => 0
proto_binary_fetched_geometry => 0
proto_binary_fetched_other => 0
init_command_executed_count => 0
init_command_failed_count => 0
com_quit => 0
com_init_db => 0
com_query => 0
com_field_list => 0
com_create_db => 0
com_drop_db => 0
com_refresh => 0
com_shutdown => 0
com_statistics => 0
com_process_info => 0
com_connect => 0
com_process_kill => 0
com_debug => 0
com_ping => 0
com_time => 0
com_delayed_insert => 0
com_change_user => 0
com_binlog_dump => 0
com_table_dump => 0
com_connect_out => 0
com_register_slave => 0
com_stmt_prepare => 0
com_stmt_execute => 0
com_stmt_send_long_data => 0
com_stmt_close => 0
com_stmt_reset => 0
com_stmt_set_option => 0
com_stmt_fetch => 0
com_deamon => 0
bytes_received_real_data_normal => 0
bytes_received_real_data_ps => 0

openssl

OpenSSL support => enabled
OpenSSL Library Version => OpenSSL 1.0.2h  3 May 2016
OpenSSL Header Version => OpenSSL 1.0.2h  3 May 2016
Openssl default config => /usr/lib/ssl/openssl.cnf

Directive => Local Value => Master Value
openssl.cafile => no value => no value
openssl.capath => no value => no value

pcntl

pcntl support => enabled

pcre

PCRE (Perl Compatible Regular Expressions) Support => enabled
PCRE Library Version => 8.31 2012-07-06
PCRE JIT Support => disabled

Directive => Local Value => Master Value
pcre.backtrack_limit => 1000000 => 1000000
pcre.jit => 1 => 1
pcre.recursion_limit => 100000 => 100000

PDO

PDO support => enabled
PDO drivers => mysql

pdo_mysql

PDO Driver for MySQL => enabled
Client API version => mysqlnd 5.0.12-dev - 20150407 - $Id: 241ae00989d1995ffcbbf63d579943635faf9972 $

Directive => Local Value => Master Value
pdo_mysql.default_socket => /var/run/mysqld/mysqld.sock => /var/run/mysqld/mysqld.sock

Phar

Phar: PHP Archive support => enabled
Phar EXT version => 2.0.2
Phar API version => 1.1.1
SVN revision => $Id: 860f5132d446a7b24c2bbf050ce6949381ea8db5 $
Phar-based phar archives => enabled
Tar-based phar archives => enabled
ZIP-based phar archives => enabled
gzip compression => enabled
bzip2 compression => disabled (install pecl/bz2)
Native OpenSSL support => enabled


Phar based on pear/PHP_Archive, original concept by Davey Shafik.
Phar fully realized by Gregory Beaver and Marcus Boerger.
Portions of tar implementation Copyright (c) 2003-2009 Tim Kientzle.
Directive => Local Value => Master Value
phar.cache_list => no value => no value
phar.readonly => On => On
phar.require_hash => On => On

posix

Revision => $Id: 771e31632526e20243748d73c150d8977fff1781 $

readline

Readline Support => enabled
Readline library => EditLine wrapper

Directive => Local Value => Master Value
cli.pager => no value => no value
cli.prompt => \b \>  => \b \> 

Reflection

Reflection => enabled
Version => $Id: 4c3f6240f4111de768fd771f35e2291d27631432 $

session

Session Support => enabled
Registered save handlers => files user 
Registered serializer handlers => php_serialize php php_binary wddx 

Directive => Local Value => Master Value
session.auto_start => Off => Off
session.cache_expire => 180 => 180
session.cache_limiter => nocache => nocache
session.cookie_domain => no value => no value
session.cookie_httponly => Off => Off
session.cookie_lifetime => 0 => 0
session.cookie_path => / => /
session.cookie_secure => Off => Off
session.entropy_file => /dev/urandom => /dev/urandom
session.entropy_length => 32 => 32
session.gc_divisor => 1000 => 1000
session.gc_maxlifetime => 1440 => 1440
session.gc_probability => 0 => 0
session.hash_bits_per_character => 5 => 5
session.hash_function => 0 => 0
session.lazy_write => On => On
session.name => PHPSESSID => PHPSESSID
session.referer_check => no value => no value
session.save_handler => files => files
session.save_path => /var/lib/php/sessions => /var/lib/php/sessions
session.serialize_handler => php => php
session.upload_progress.cleanup => On => On
session.upload_progress.enabled => On => On
session.upload_progress.freq => 1% => 1%
session.upload_progress.min_freq => 1 => 1
session.upload_progress.name => PHP_SESSION_UPLOAD_PROGRESS => PHP_SESSION_UPLOAD_PROGRESS
session.upload_progress.prefix => upload_progress_ => upload_progress_
session.use_cookies => On => On
session.use_only_cookies => On => On
session.use_strict_mode => Off => Off
session.use_trans_sid => 0 => 0

shmop

shmop support => enabled

SimpleXML

Simplexml support => enabled
Revision => $Id: 8a1ef4915f2024925ab80334b809c691c2cc0196 $
Schema support => enabled

sockets

Sockets Support => enabled

SPL

SPL support => enabled
Interfaces => Countable, OuterIterator, RecursiveIterator, SeekableIterator, SplObserver, SplSubject
Classes => AppendIterator, ArrayIterator, ArrayObject, BadFunctionCallException, BadMethodCallException, CachingIterator, CallbackFilterIterator, DirectoryIterator, DomainException, EmptyIterator, FilesystemIterator, FilterIterator, GlobIterator, InfiniteIterator, InvalidArgumentException, IteratorIterator, LengthException, LimitIterator, LogicException, MultipleIterator, NoRewindIterator, OutOfBoundsException, OutOfRangeException, OverflowException, ParentIterator, RangeException, RecursiveArrayIterator, RecursiveCachingIterator, RecursiveCallbackFilterIterator, RecursiveDirectoryIterator, RecursiveFilterIterator, RecursiveIteratorIterator, RecursiveRegexIterator, RecursiveTreeIterator, RegexIterator, RuntimeException, SplDoublyLinkedList, SplFileInfo, SplFileObject, SplFixedArray, SplHeap, SplMinHeap, SplMaxHeap, SplObjectStorage, SplPriorityQueue, SplQueue, SplStack, SplTempFileObject, UnderflowException, UnexpectedValueException

standard

Dynamic Library Support => enabled
Path to sendmail => /usr/sbin/sendmail -t -i 

Directive => Local Value => Master Value
assert.active => 1 => 1
assert.bail => 0 => 0
assert.callback => no value => no value
assert.exception => 0 => 0
assert.quiet_eval => 0 => 0
assert.warning => 1 => 1
auto_detect_line_endings => 0 => 0
default_socket_timeout => 60 => 60
from => no value => no value
url_rewriter.tags => a=href,area=href,frame=src,input=src,form=fakeentry => a=href,area=href,frame=src,input=src,form=fakeentry
user_agent => no value => no value

sysvmsg

sysvmsg support => enabled
Revision => $Id: b291daed03ee2339361df6b8cd4d9f5eb4c76387 $

sysvsem

Version => 7.0.9-1+deb.sury.org~trusty+1

sysvshm

Version => 7.0.9-1+deb.sury.org~trusty+1

tokenizer

Tokenizer Support => enabled

wddx

WDDX Support => enabled
WDDX Session Serializer => enabled

xdebug

xdebug support => enabled
Version => 2.4.1
IDE Key => kidd

Supported protocols => Revision
DBGp - Common DeBuGger Protocol => $Revision: 1.145 $

Directive => Local Value => Master Value
xdebug.auto_trace => Off => Off
xdebug.cli_color => 0 => 0
xdebug.collect_assignments => Off => Off
xdebug.collect_includes => On => On
xdebug.collect_params => 0 => 0
xdebug.collect_return => Off => Off
xdebug.collect_vars => Off => Off
xdebug.coverage_enable => On => On
xdebug.default_enable => On => On
xdebug.dump.COOKIE => no value => no value
xdebug.dump.ENV => no value => no value
xdebug.dump.FILES => no value => no value
xdebug.dump.GET => no value => no value
xdebug.dump.POST => no value => no value
xdebug.dump.REQUEST => no value => no value
xdebug.dump.SERVER => no value => no value
xdebug.dump.SESSION => no value => no value
xdebug.dump_globals => On => On
xdebug.dump_once => On => On
xdebug.dump_undefined => Off => Off
xdebug.extended_info => On => On
xdebug.file_link_format => no value => no value
xdebug.force_display_errors => Off => Off
xdebug.force_error_reporting => 0 => 0
xdebug.halt_level => 0 => 0
xdebug.idekey => no value => no value
xdebug.max_nesting_level => 256 => 256
xdebug.max_stack_frames => -1 => -1
xdebug.overload_var_dump => 2 => 2
xdebug.profiler_aggregate => Off => Off
xdebug.profiler_append => Off => Off
xdebug.profiler_enable => Off => Off
xdebug.profiler_enable_trigger => Off => Off
xdebug.profiler_enable_trigger_value => no value => no value
xdebug.profiler_output_dir => /tmp => /tmp
xdebug.profiler_output_name => cachegrind.out.%p => cachegrind.out.%p
xdebug.remote_addr_header => no value => no value
xdebug.remote_autostart => Off => Off
xdebug.remote_connect_back => Off => Off
xdebug.remote_cookie_expire_time => 3600 => 3600
xdebug.remote_enable => On => On
xdebug.remote_handler => dbgp => dbgp
xdebug.remote_host => 127.0.0.1 => 127.0.0.1
xdebug.remote_log => no value => no value
xdebug.remote_mode => req => req
xdebug.remote_port => 9000 => 9000
xdebug.scream => Off => Off
xdebug.show_error_trace => Off => Off
xdebug.show_exception_trace => Off => Off
xdebug.show_local_vars => Off => Off
xdebug.show_mem_delta => Off => Off
xdebug.trace_enable_trigger => Off => Off
xdebug.trace_enable_trigger_value => no value => no value
xdebug.trace_format => 0 => 0
xdebug.trace_options => 0 => 0
xdebug.trace_output_dir => /tmp => /tmp
xdebug.trace_output_name => trace.%c => trace.%c
xdebug.var_display_max_children => 128 => 128
xdebug.var_display_max_data => 512 => 512
xdebug.var_display_max_depth => 3 => 3

xml

XML Support => active
XML Namespace Support => active
libxml2 Version => 2.9.1

xmlreader

XMLReader => enabled

xmlwriter

XMLWriter => enabled

xsl

XSL => enabled
libxslt Version => 1.1.28
libxslt compiled against libxml Version => 2.9.1
EXSLT => enabled
libexslt Version => 1.1.28

Zend OPcache

Opcode Caching => Disabled
Optimization => Disabled
SHM Cache => Enabled
File Cache => Disabled
Startup Failed => Opcode Caching is disabled for CLI

Directive => Local Value => Master Value
opcache.blacklist_filename => no value => no value
opcache.consistency_checks => 0 => 0
opcache.dups_fix => Off => Off
opcache.enable => On => On
opcache.enable_cli => Off => Off
opcache.enable_file_override => Off => Off
opcache.error_log => no value => no value
opcache.fast_shutdown => 0 => 0
opcache.file_cache => no value => no value
opcache.file_cache_consistency_checks => 1 => 1
opcache.file_cache_only => 0 => 0
opcache.file_update_protection => 2 => 2
opcache.force_restart_timeout => 180 => 180
opcache.huge_code_pages => Off => Off
opcache.inherited_hack => On => On
opcache.interned_strings_buffer => 4 => 4
opcache.lockfile_path => /tmp => /tmp
opcache.log_verbosity_level => 1 => 1
opcache.max_accelerated_files => 2000 => 2000
opcache.max_file_size => 0 => 0
opcache.max_wasted_percentage => 5 => 5
opcache.memory_consumption => 64 => 64
opcache.optimization_level => 0x7FFFBFFF => 0x7FFFBFFF
opcache.preferred_memory_model => no value => no value
opcache.protect_memory => 0 => 0
opcache.restrict_api => no value => no value
opcache.revalidate_freq => 2 => 2
opcache.revalidate_path => Off => Off
opcache.save_comments => 1 => 1
opcache.use_cwd => On => On
opcache.validate_timestamps => On => On

zlib

ZLib Support => enabled
Stream Wrapper => compress.zlib://
Stream Filter => zlib.inflate, zlib.deflate
Compiled Version => 1.2.8
Linked Version => 1.2.8

Directive => Local Value => Master Value
zlib.output_compression => Off => Off
zlib.output_compression_level => -1 => -1
zlib.output_handler => no value => no value

Additional Modules

Module Name

Environment

Variable => Value
XDG_VTNR => 7
LC_PAPER => zh_CN.UTF-8
SSH_AGENT_PID => 3821
LC_ADDRESS => zh_CN.UTF-8
XDG_SESSION_ID => c41
XDG_GREETER_DATA_DIR => /var/lib/lightdm-data/kidd
SELINUX_INIT => YES
LC_MONETARY => zh_CN.UTF-8
CLUTTER_IM_MODULE => xim
ANDROID_HOME => /home/kidd/software/android-sdk-linux
GPG_AGENT_INFO => /run/user/1000/keyring-1fc4K9/gpg:0:1
TERM => xterm
VTE_VERSION => 3409
SHELL => /bin/bash
SSH_AGENT_LAUNCHER => upstart
ROS_MASTER_URI => http://192.168.0.15:11311
ANDROID_SDK_ROOT => /home/kidd/software/android-sdk-linux
WINDOWID => 69206028
LC_NUMERIC => zh_CN.UTF-8
OLDPWD => /home/kidd/workspace/bc/advanced/MissionImpossible/console
UPSTART_SESSION => unix:abstract=/com/ubuntu/upstart-session/1000/3762
GNOME_KEYRING_CONTROL => /run/user/1000/keyring-1fc4K9
GTK_MODULES => overlay-scrollbar:unity-gtk-module
USER => kidd
LS_COLORS => rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lz=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.axa=00;36:*.oga=00;36:*.spx=00;36:*.xspf=00;36:
LC_TELEPHONE => zh_CN.UTF-8
ANDROID_NDK_ROOT => /home/kidd/software/android-ndk-r10d
XDG_SESSION_PATH => /org/freedesktop/DisplayManager/Session0
XDG_SEAT_PATH => /org/freedesktop/DisplayManager/Seat0
SSH_AUTH_SOCK => /run/user/1000/keyring-1fc4K9/ssh
DEFAULTS_PATH => /usr/share/gconf/ubuntu.default.path
XDG_CONFIG_DIRS => /etc/xdg/xdg-ubuntu:/usr/share/upstart/xdg:/etc/xdg
NODEJS_ROOT => /home/kidd/software/nodejs
ROS_MAVEN_DEPLOYMENT_REPOSITORY => /home/kidd/workspace/ros_android/ros_latest/src/rosjava/rosjava_mvn_repo
DESKTOP_SESSION => ubuntu
PATH => /home/kidd/software/bin:/home/kidd/software/bin/gradle-2.1/bin:/home/kidd/software/android-ndk-r10d:/home/kidd/software/android-sdk-linux:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/home/kidd/software/bin/r10d-androideabi-4.9:/home/kidd/software/nodejs/bin:/home/kidd/software/android-sdk-linux/build-tools/21.1.2:/home/kidd/software/bin/n/bin:/home/kidd/software/depot_tools:/home/kidd/software/android-sdk-linux/platform-tools:/home/kidd/software/kidd_tools/:/home/kidd/workspace/jos/qemu/build/bin:/home/kidd/software/apache-maven-3.3.9/bin:/home/kidd/software/PhpStorm-162.1121.38/bin
QT_IM_MODULE => ibus
QT_QPA_PLATFORMTHEME => appmenu-qt5
LC_IDENTIFICATION => zh_CN.UTF-8
PWD => /home/kidd/workspace/bc/advanced/MissionImpossible
JOB => gnome-session
JAVA_HOME => /home/kidd/software/jdk1.7.0_67
XMODIFIERS => @im=ibus
ROS_HOSTNAME => 10.2.4.129
GNOME_KEYRING_PID => 3758
LANG => en_US.UTF-8
GDM_LANG => en_US
MANDATORY_PATH => /usr/share/gconf/ubuntu.mandatory.path
NODE_PATH => /usr/lib/nodejs:/usr/lib/node_modules:/usr/share/javascript
LC_MEASUREMENT => zh_CN.UTF-8
ROS_MAVEN_REPOSITORY => file:///home/kidd/workspace/ros_android/ros_latest/src/rosjava/rosjava_mvn_repo
UBUNTU_MENUPROXY => 1
COMPIZ_CONFIG_PROFILE => ubuntu
IM_CONFIG_PHASE => 1
DOLPHIN_PRODUCT_NAME => INT
GDMSESSION => ubuntu
SESSIONTYPE => gnome-session
SHLVL => 1
HOME => /home/kidd
XDG_SEAT => seat0
SDK_PATH => /home/kidd/software/android-sdk-linux
LANGUAGE => en_US
GNOME_DESKTOP_SESSION_ID => this-is-deprecated
IBUS_ENABLE_SYNC_MODE => 1
UPSTART_INSTANCE =>  
UPSTART_EVENTS => started starting
LOGNAME => kidd
ROS_IP => 10.2.4.129
CLASSPATH => .::/home/kidd/software/jdk1.7.0_67/lib:/home/kidd/software/jdk1.7.0_67/jre/lib:/home/kidd/software/android-sdk-linux/platform-tools:/home/kidd/software/android-sdk-linux/toos
DBUS_SESSION_BUS_ADDRESS => unix:abstract=/tmp/dbus-Qsstszddgr
XDG_DATA_DIRS => /usr/share/ubuntu:/usr/share/gnome:/usr/local/share/:/usr/share/
QT4_IM_MODULE => xim
LESSOPEN => | /usr/bin/lesspipe %s
INSTANCE => Unity
TEXTDOMAIN => im-config
UPSTART_JOB => unity-settings-daemon
XDG_RUNTIME_DIR => /run/user/1000
DISPLAY => :0
XDG_CURRENT_DESKTOP => Unity
GTK_IM_MODULE => ibus
ANDROID_STANDALONE_TOOLCHAIN => /home/kidd/workspace/ros_android/ros_latest/arm-linux-android
LESSCLOSE => /usr/bin/lesspipe %s %s
LC_TIME => zh_CN.UTF-8
TEXTDOMAINDIR => /usr/share/locale/
LC_NAME => zh_CN.UTF-8
XAUTHORITY => /home/kidd/.Xauthority
COLORTERM => gnome-terminal
_ => /usr/bin/php

PHP Variables

Variable => Value
$_SERVER['XDG_VTNR'] => 7
$_SERVER['LC_PAPER'] => zh_CN.UTF-8
$_SERVER['SSH_AGENT_PID'] => 3821
$_SERVER['LC_ADDRESS'] => zh_CN.UTF-8
$_SERVER['XDG_SESSION_ID'] => c41
$_SERVER['XDG_GREETER_DATA_DIR'] => /var/lib/lightdm-data/kidd
$_SERVER['SELINUX_INIT'] => YES
$_SERVER['LC_MONETARY'] => zh_CN.UTF-8
$_SERVER['CLUTTER_IM_MODULE'] => xim
$_SERVER['ANDROID_HOME'] => /home/kidd/software/android-sdk-linux
$_SERVER['GPG_AGENT_INFO'] => /run/user/1000/keyring-1fc4K9/gpg:0:1
$_SERVER['TERM'] => xterm
$_SERVER['VTE_VERSION'] => 3409
$_SERVER['SHELL'] => /bin/bash
$_SERVER['SSH_AGENT_LAUNCHER'] => upstart
$_SERVER['ROS_MASTER_URI'] => http://192.168.0.15:11311
$_SERVER['ANDROID_SDK_ROOT'] => /home/kidd/software/android-sdk-linux
$_SERVER['WINDOWID'] => 69206028
$_SERVER['LC_NUMERIC'] => zh_CN.UTF-8
$_SERVER['OLDPWD'] => /home/kidd/workspace/bc/advanced/MissionImpossible/console
$_SERVER['UPSTART_SESSION'] => unix:abstract=/com/ubuntu/upstart-session/1000/3762
$_SERVER['GNOME_KEYRING_CONTROL'] => /run/user/1000/keyring-1fc4K9
$_SERVER['GTK_MODULES'] => overlay-scrollbar:unity-gtk-module
$_SERVER['USER'] => kidd
$_SERVER['LS_COLORS'] => rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lz=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.axa=00;36:*.oga=00;36:*.spx=00;36:*.xspf=00;36:
$_SERVER['LC_TELEPHONE'] => zh_CN.UTF-8
$_SERVER['ANDROID_NDK_ROOT'] => /home/kidd/software/android-ndk-r10d
$_SERVER['XDG_SESSION_PATH'] => /org/freedesktop/DisplayManager/Session0
$_SERVER['XDG_SEAT_PATH'] => /org/freedesktop/DisplayManager/Seat0
$_SERVER['SSH_AUTH_SOCK'] => /run/user/1000/keyring-1fc4K9/ssh
$_SERVER['DEFAULTS_PATH'] => /usr/share/gconf/ubuntu.default.path
$_SERVER['XDG_CONFIG_DIRS'] => /etc/xdg/xdg-ubuntu:/usr/share/upstart/xdg:/etc/xdg
$_SERVER['NODEJS_ROOT'] => /home/kidd/software/nodejs
$_SERVER['ROS_MAVEN_DEPLOYMENT_REPOSITORY'] => /home/kidd/workspace/ros_android/ros_latest/src/rosjava/rosjava_mvn_repo
$_SERVER['DESKTOP_SESSION'] => ubuntu
$_SERVER['PATH'] => /home/kidd/software/bin:/home/kidd/software/bin/gradle-2.1/bin:/home/kidd/software/android-ndk-r10d:/home/kidd/software/android-sdk-linux:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/home/kidd/software/bin/r10d-androideabi-4.9:/home/kidd/software/nodejs/bin:/home/kidd/software/android-sdk-linux/build-tools/21.1.2:/home/kidd/software/bin/n/bin:/home/kidd/software/depot_tools:/home/kidd/software/android-sdk-linux/platform-tools:/home/kidd/software/kidd_tools/:/home/kidd/workspace/jos/qemu/build/bin:/home/kidd/software/apache-maven-3.3.9/bin:/home/kidd/software/PhpStorm-162.1121.38/bin
$_SERVER['QT_IM_MODULE'] => ibus
$_SERVER['QT_QPA_PLATFORMTHEME'] => appmenu-qt5
$_SERVER['LC_IDENTIFICATION'] => zh_CN.UTF-8
$_SERVER['PWD'] => /home/kidd/workspace/bc/advanced/MissionImpossible
$_SERVER['JOB'] => gnome-session
$_SERVER['JAVA_HOME'] => /home/kidd/software/jdk1.7.0_67
$_SERVER['XMODIFIERS'] => @im=ibus
$_SERVER['ROS_HOSTNAME'] => 10.2.4.129
$_SERVER['GNOME_KEYRING_PID'] => 3758
$_SERVER['LANG'] => en_US.UTF-8
$_SERVER['GDM_LANG'] => en_US
$_SERVER['MANDATORY_PATH'] => /usr/share/gconf/ubuntu.mandatory.path
$_SERVER['NODE_PATH'] => /usr/lib/nodejs:/usr/lib/node_modules:/usr/share/javascript
$_SERVER['LC_MEASUREMENT'] => zh_CN.UTF-8
$_SERVER['ROS_MAVEN_REPOSITORY'] => file:///home/kidd/workspace/ros_android/ros_latest/src/rosjava/rosjava_mvn_repo
$_SERVER['UBUNTU_MENUPROXY'] => 1
$_SERVER['COMPIZ_CONFIG_PROFILE'] => ubuntu
$_SERVER['IM_CONFIG_PHASE'] => 1
$_SERVER['DOLPHIN_PRODUCT_NAME'] => INT
$_SERVER['GDMSESSION'] => ubuntu
$_SERVER['SESSIONTYPE'] => gnome-session
$_SERVER['SHLVL'] => 1
$_SERVER['HOME'] => /home/kidd
$_SERVER['XDG_SEAT'] => seat0
$_SERVER['SDK_PATH'] => /home/kidd/software/android-sdk-linux
$_SERVER['LANGUAGE'] => en_US
$_SERVER['GNOME_DESKTOP_SESSION_ID'] => this-is-deprecated
$_SERVER['IBUS_ENABLE_SYNC_MODE'] => 1
$_SERVER['UPSTART_INSTANCE'] => 
$_SERVER['UPSTART_EVENTS'] => started starting
$_SERVER['LOGNAME'] => kidd
$_SERVER['ROS_IP'] => 10.2.4.129
$_SERVER['CLASSPATH'] => .::/home/kidd/software/jdk1.7.0_67/lib:/home/kidd/software/jdk1.7.0_67/jre/lib:/home/kidd/software/android-sdk-linux/platform-tools:/home/kidd/software/android-sdk-linux/toos
$_SERVER['DBUS_SESSION_BUS_ADDRESS'] => unix:abstract=/tmp/dbus-Qsstszddgr
$_SERVER['XDG_DATA_DIRS'] => /usr/share/ubuntu:/usr/share/gnome:/usr/local/share/:/usr/share/
$_SERVER['QT4_IM_MODULE'] => xim
$_SERVER['LESSOPEN'] => | /usr/bin/lesspipe %s
$_SERVER['INSTANCE'] => Unity
$_SERVER['TEXTDOMAIN'] => im-config
$_SERVER['UPSTART_JOB'] => unity-settings-daemon
$_SERVER['XDG_RUNTIME_DIR'] => /run/user/1000
$_SERVER['DISPLAY'] => :0
$_SERVER['XDG_CURRENT_DESKTOP'] => Unity
$_SERVER['GTK_IM_MODULE'] => ibus
$_SERVER['ANDROID_STANDALONE_TOOLCHAIN'] => /home/kidd/workspace/ros_android/ros_latest/arm-linux-android
$_SERVER['LESSCLOSE'] => /usr/bin/lesspipe %s %s
$_SERVER['LC_TIME'] => zh_CN.UTF-8
$_SERVER['TEXTDOMAINDIR'] => /usr/share/locale/
$_SERVER['LC_NAME'] => zh_CN.UTF-8
$_SERVER['XAUTHORITY'] => /home/kidd/.Xauthority
$_SERVER['COLORTERM'] => gnome-terminal
$_SERVER['_'] => /usr/bin/php
$_SERVER['PHP_SELF'] => yii
$_SERVER['SCRIPT_NAME'] => yii
$_SERVER['SCRIPT_FILENAME'] => yii
$_SERVER['PATH_TRANSLATED'] => yii
$_SERVER['DOCUMENT_ROOT'] => 
$_SERVER['REQUEST_TIME_FLOAT'] => 1473843239.4686
$_SERVER['REQUEST_TIME'] => 1473843239
$_SERVER['argv'] => Array
(
    [0] => yii
    [1] => console/start-worker
)

$_SERVER['argc'] => 2

PHP License
This program is free software; you can redistribute it and/or modify
it under the terms of the PHP License as published by the PHP Group
and included in the distribution in the file:  LICENSE

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

If you did not receive a copy of the PHP license, or have any
questions about PHP licensing, please contact license@php.net.

-------- 2016-10-08 13:51:45


        // 将头像修剪成圆形
        $crop = new CircleCrop($avatar);
        $crop->crop();
        $croped_avatar = $crop->getDest();

        
<?php

namespace frontend\components\util;

class CircleCrop
{

    public $src_img;
    public $src_w;
    public $src_h;
    public $dst_img;
    public $dst_w;
    public $dst_h;

    public function __construct($img)
    {
        $this->src_img = $img;
        $this->src_w = imagesx($img);
        $this->src_h = imagesy($img);
        $this->dst_w = imagesx($img);
        $this->dst_h = imagesy($img);
    }

    public function __destruct()
    {
        if (is_resource($this->dst_img)) {
            imagedestroy($this->dst_img);
        }
    }

    public function display()
    {
        header("Content-type: image/png");
        imagepng($this->dst_img);
        return $this;
    }

    public function getDest()
    {
        return $this->dst_img;
    }

    public function reset()
    {
        if (is_resource(($this->dst_img))) {
            imagedestroy($this->dst_img);
        }
        $this->dst_img = imagecreatetruecolor($this->dst_w, $this->dst_h);
        imagecopy($this->dst_img, $this->src_img, 0, 0, 0, 0, $this->dst_w, $this->dst_h);
        return $this;
    }

    public function size($dstWidth, $dstHeight)
    {
        $this->dst_w = $dstWidth;
        $this->dst_h = $dstHeight;
        return $this->reset();
    }

    public function crop()
    {
        // Intializes destination image
        $this->reset();

        // Create a black image with a transparent ellipse, and merge with destination
        $mask = imagecreatetruecolor($this->dst_w, $this->dst_h);
        $maskTransparent = imagecolorallocate($mask, 255, 0, 255);
        imagecolortransparent($mask, $maskTransparent);
        imagefilledellipse($mask, $this->dst_w / 2, $this->dst_h / 2, $this->dst_w, $this->dst_h, $maskTransparent);
        imagecopymerge($this->dst_img, $mask, 0, 0, 0, 0, $this->dst_w, $this->dst_h, 100);

        // Fill each corners of destination image with transparency
        $dstTransparent = imagecolorallocate($this->dst_img, 255, 0, 255);
        imagefill($this->dst_img, 0, 0, $dstTransparent);
        imagefill($this->dst_img, $this->dst_w - 1, 0, $dstTransparent);
        imagefill($this->dst_img, 0, $this->dst_h - 1, $dstTransparent);
        imagefill($this->dst_img, $this->dst_w - 1, $this->dst_h - 1, $dstTransparent);
        imagecolortransparent($this->dst_img, $dstTransparent);

        return $this;
    }
}
